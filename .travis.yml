rvm: 2.4.1
cache: bundler
sudo: false
dist: trusty

before_install:
- wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-${ES_VERSION}.tar.gz
- tar -xzf elasticsearch-${ES_VERSION}.tar.gz
- ./elasticsearch-${ES_VERSION}/bin/elasticsearch -d

before_script:
- cp test/dummy/.env.example test/dummy/.env
- wget --quiet --waitretry=1 --retry-connrefused --timeout=20 -O - http://127.0.0.1:9200
- bundle exec rake app:db:setup
- bundle exec rake app:index:reset

env:
  matrix:
  - ES_VERSION=5.6.7
  - ES_VERSION=6.2.3

services:
- postgresql
